import{r as d,u as S,ar as T,j as e,as as C,at as I,au as U,Z as F,h as N,av as _,R as E,a0 as b}from"./index-59f2354e.js";import{a as O}from"./dto-0c8e3693.js";import{u as D}from"./useOrganizationHandler-a9522fa4.js";import{c as B,g as M}from"./utils-4a35f25f.js";import{F as r,m as k,A as L}from"./motion-db2b8b92.js";import{S as V}from"./index-c51833f7.js";import{I as o}from"./index-dc7f8182.js";import{S as a}from"./index-9f2fb8c4.js";import{B as v}from"./button-d04776d9.js";import{n as R}from"./index-eaf1928d.js";import{M as W}from"./index-394ef855.js";function re({onSubmit:c,isSubmitting:l,user:s,errorMessage:i,isAdminUser:u}){const[p,h]=d.useState("Form"),{state:x}=S(),[n]=r.useForm(),j=r.useWatch("account_type",n),f=!!s,g=B().getData(),m=()=>{c(n.getFieldsValue(!0))},{subscriptionBoards:q}=D(),{data:w,isLoading:A}=T({params:{user_id:s==null?void 0:s.id},enabled:!!s}),P=d.useMemo(()=>O(s),[s]);return d.useEffect(()=>{n.setFieldsValue({databoards:w?w.map(t=>t.databoard_id):[]})},[w,n]),e.jsxs(V,{spinning:A||l,children:[s&&e.jsxs("div",{className:"flex  gap-2 mt-3",children:[e.jsx(C,{style:{background:"#ccdaea",color:"#173659"},className:"text-2xl font-bold p-5",children:I(s.full_name)}),e.jsxs("span",{className:"text-content-default",children:[e.jsx("p",{className:"font-bold -my-1 ",children:s==null?void 0:s.full_name}),e.jsx("p",{children:s.email}),p==="Form"&&e.jsxs("div",{onClick:()=>{h("Password")},className:"cursor-pointer flex gap-1 items-center text-blue-700",children:[e.jsx(U,{}),e.jsx("span",{children:"Edit Password"})]})]})]}),e.jsxs(r,{requiredMark:!1,form:n,onFinish:m,layout:"vertical",name:"edit_user",initialValues:P,children:[e.jsx(k.div,{initial:{opacity:0,marginBottom:0},animate:{opacity:i?1:0,marginBottom:i?10:0},children:e.jsx(L,{type:"error",showIcon:!0,message:i})}),e.jsx("div",{className:"min-h-[500px]",children:p=="Form"?e.jsxs(F.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(r.Item,{label:"First Name",name:"first_name",rules:[{required:!0,message:"This field is required"}],children:e.jsx(o,{placeholder:"First Name"})}),e.jsx(r.Item,{label:"Last Name",name:"last_name",rules:[{required:!0,message:"This field is required"}],children:e.jsx(o,{placeholder:"Last Name"})}),e.jsx(r.Item,{label:"Email",name:"email",rules:[{required:!0,message:"This field is required",type:"email"}],children:e.jsx(o,{placeholder:"Input email"})}),!f&&e.jsx(r.Item,{label:"Password",name:"password",rules:[{required:!0,message:"This field is required"}],children:e.jsx(o.Password,{placeholder:"Password"})}),e.jsx(r.Item,{label:"Account Type",name:"account_type",rules:[{required:!0,message:"This field is required"}],children:e.jsx(a,{placeholder:"Select Account Type",children:u?e.jsxs(e.Fragment,{children:[e.jsx(a.Option,{value:"Super Administrator",children:"Super Administrator"}),e.jsx(a.Option,{value:"Sales Administrator",children:"Sales Administrator"}),e.jsx(a.Option,{value:"Data Administrator",children:"Data Administrator"})]}):e.jsxs(e.Fragment,{children:[e.jsx(a.Option,{value:"Administrator",children:"Administrator"}),e.jsx(a.Option,{value:"User",children:"User"})]})})}),e.jsx(r.Item,{label:"Phone Number",name:"phone_number",rules:[{required:!0,message:"This field is required"}],children:e.jsx(o,{placeholder:"Phone Number"})}),e.jsx(r.Item,{label:"Whatsapp Number",name:"whatsapp_number",rules:[{required:!0,message:"This field is required"}],children:e.jsx(o,{placeholder:"Whatsapp Number"})}),N(x.user,"canEditAccountUserStatus")&&e.jsx(r.Item,{label:"Status",name:"status",rules:[{required:!0,message:"This field is required"}],children:e.jsxs(a,{placeholder:"Select status",children:[e.jsx(a.Option,{value:"pending",children:"Pending"}),e.jsx(a.Option,{value:"approval request",children:"Approval request"}),N(x.user,"canApproveAccountUsers")&&e.jsx(a.Option,{value:"active",children:"Approved"})]})}),!u&&j!=="Administrator"&&e.jsx("div",{className:"col-span-2",children:e.jsx(r.Item,{label:"Dashboard Access",name:"databoards",rules:[{required:!0,message:"This field is required"}],children:e.jsx(a,{defaultValue:["1","2"],placeholder:"Select Dashboard(s) ",mode:"multiple",allowClear:!0,children:q.map(t=>e.jsx(a.Option,{value:t.databoard_id,children:M(t.country)},t.databoard_id))})})}),!u&&e.jsx("div",{className:"col-span-2",children:e.jsx(r.Item,{label:"Country of Access",name:"access_country_restriction",rules:[{required:!0,message:"This field is required"}],children:e.jsxs(a,{placeholder:"Select Country of Access",mode:"multiple",allowClear:!0,children:[e.jsx(a.Option,{children:"All Countries"},"All Countries"),g.map(t=>e.jsx(a.Option,{value:t.value,children:t.label},t.value))]})})})]}),e.jsx(v,{htmlType:"submit",className:"w-full my-7",type:"primary",loading:l,children:"Update"})]}):e.jsxs("div",{className:"md:max-w-[300px]",children:[e.jsxs("div",{className:"flex gap-1 text-2xl font-bold items-center mb-5",children:[e.jsx("span",{onClick:()=>{h("Form"),n.setFieldsValue({password:""})},children:e.jsx(_,{})}),e.jsx("span",{className:"mb-1",children:"Change Password"})]}),e.jsx(r.Item,{label:"New Password",name:"password",rules:[{required:!0,message:"This field is required"}],children:e.jsx(o.Password,{placeholder:"New Password"})}),e.jsx(r.Item,{label:"Confirm Password",name:"confirm_password",rules:[{required:!0,message:"This field is required"},({getFieldValue:t})=>({validator(z,y){return!y||t("password")===y?Promise.resolve():Promise.reject(new Error("The new password that you entered do not match!"))}})],children:e.jsx(o.Password,{placeholder:"Confirm Password"})}),e.jsx(v,{htmlType:"submit",className:"w-full mt-3",type:"primary",loading:l,children:"Change Password"})]})})]})]})}function ae(){const[c,l]=d.useState(""),[s,i]=d.useState(!1),[u,p]=d.useState(""),[h,x]=d.useState(""),{mutate:n,isPending:j,isSuccess:f,isError:g}=E({method:"update",model:"Users",onSuccess:m=>{R.success({message:"User saved successfully",placement:"topRight"})},onError:m=>{console.log("useSaveUser err",m),l("Error creating user")}});return d.useEffect(()=>{if(c){const m=setTimeout(()=>l(""),5e3);return()=>{clearTimeout(m)}}},[c]),{state:{newPassword:h,newUsername:u,openSuccessModal:s,isLoading:j,errorMessage:c,isSuccess:f,isError:g},actions:{setNewPassword:x,setNewUsername:p,setOpenSuccessModal:i,setErrorMessage:l,saveUser:n}}}const te=({openSuccessModal:c,newUsername:l,newPassword:s,setOpenSuccessModal:i})=>e.jsxs(W,{destroyOnClose:!0,centered:!0,width:500,footer:null,open:c,title:"User Credentials Updated",className:"modal header",onCancel:()=>i(!1),children:[e.jsx(b,{}),e.jsxs("div",{className:"w-full -my-2 flex justify-between",children:[e.jsx("span",{className:"font-bold",children:"Email:"})," ",e.jsx("span",{children:l})]}),e.jsx(b,{}),e.jsxs("div",{className:"w-full -my-2 flex justify-between",children:[e.jsx("span",{className:"font-bold",children:"Password:"}),e.jsx("div",{className:"flex gap-2 items-center",children:e.jsx("span",{children:s})})]}),e.jsx(b,{}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{onClick:()=>i(!1),type:"primary",children:"Close"})})]});export{re as E,te as U,ae as u};
