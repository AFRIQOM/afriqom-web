import{bv as c,bw as d,u as g,r as l,bx as p,j as s,b as m,A as f}from"./index-59f2354e.js";import{L as h}from"./Layout-5ab9a001.js";import{n as x}from"./index-eaf1928d.js";import{F as a,m as w,A as E}from"./motion-db2b8b92.js";import{I as u,E as j}from"./index-dc7f8182.js";import{B as y}from"./button-d04776d9.js";import{E as b}from"./EyeTwoTone-f6651667.js";import{S as I}from"./dto-0c8e3693.js";import"./InfoCircleFilled-23b8bc08.js";import"./CloseCircleFilled-f69f152a.js";import"./collapse-97de76d4.js";const L={login:async t=>{const o=await c.post("",t,{params:{f:"sessions:login"}});if(o.ERR)throw new d(o.CODE,"Incorrect email or password");const e=await c.post("",t,{params:{f:"users:list",token:o.token,id:o.info[0].id}});if(e.ERR||e.length==0)throw new Error("Incorrect email or password");let n;if(e[0].access_portal=="client"){const r=await c.post("",t,{params:{f:"organisations:list",token:o.token,id:e[0].organisation_id}});if(r.ERR)throw new Error("Incorrect email or password");n=r[0]}return{loginMetaData:o,user:e[0],currentOrganization:n}}};function v(...t){}function R(){const{actions:t}=g(),[o,e]=l.useState(""),{mutate:n,isPending:r}=p({mutationFn:i=>L.login(i),onSuccess:i=>{x.success({message:"Login successful",placement:"topRight"}),t.onLoginSuccess(i)},onError:i=>{i.status===401?e("Sorry, but this account is not accessible from your country. If you believe this is a mistake or need further assistance, please contact our support team."):e("Incorrect email or password"),v("log in error",i.status,i.message)}});return l.useEffect(()=>{if(o){const i=setTimeout(()=>e(""),1e4);return()=>{clearTimeout(i)}}},[o]),l.useEffect(()=>{r&&e("")},[r]),{state:{isLoading:r,errorMessage:o},actions:{setErrorMessage:e,login:n}}}const A=({signIn:t,loading:o,errorMessage:e})=>{const n=r=>{t(r),console.log(r)};return s.jsx("div",{children:s.jsxs(a,{name:"login",initialValues:{remember:!0},onFinish:n,layout:"vertical",requiredMark:"optional",children:[s.jsx(w.div,{initial:{opacity:0,marginBottom:0},animate:{opacity:e?1:0,marginBottom:e?10:0},children:s.jsx(E,{type:"error",showIcon:!0,message:e})}),s.jsx(a.Item,{label:"Email",name:"username",rules:[{required:!0,message:"This field is required!"}],children:s.jsx(u,{placeholder:"Enter Email Address",size:"large"})}),s.jsx(a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"This field is required!"}],children:s.jsx(u.Password,{placeholder:"Enter Password",size:"large",iconRender:r=>r?s.jsx(b,{rev:void 0}):s.jsx(j,{rev:void 0})})}),s.jsx(a.Item,{children:s.jsx(y,{loading:o,type:"primary",size:"large",htmlType:"submit",className:"w-full  text-white",children:"Sign in"})}),s.jsxs("div",{className:" text-center",children:[s.jsx(m,{to:"/forgotPassword",className:"text-[#047857] font-normal",children:"Forget your password? Click here"}),s.jsxs("p",{children:["Don't have an account?"," ",s.jsx(m,{to:f.register,className:"text-[#047857] font-semibold",children:"Create an account"})]})]})]})})},C=()=>{const t=R(),o=e=>{const n=I(e);t.actions.login(n)};return s.jsx(h,{title:"Log in to Afriqom",children:s.jsx(A,{signIn:o,loading:t.state.isLoading,errorMessage:t.state.errorMessage})})};export{C as default};
