import{j as e,s as m,r as p,L as R,u as k,a as F,b as $,A as Y,bn as B}from"./index-59f2354e.js";import{P as O}from"./container-03e214f9.js";import{g as L}from"./utils-4a35f25f.js";import{B as C}from"./button-d04776d9.js";import{u as P}from"./useOrganizationHandler-a9522fa4.js";import{u as E}from"./UseRegionDatabords-31b186c5.js";import{u as z}from"./useSubscriptionMutator-52eb5755.js";import{d as g}from"./dayjs.min-36613c82.js";import{S as G}from"./index-c51833f7.js";import"./useGetSubscriptionsView-43e8743f.js";import"./index-eaf1928d.js";import"./InfoCircleFilled-23b8bc08.js";import"./CloseCircleFilled-f69f152a.js";function I({isSelected:r}){return e.jsx("div",{className:m("h-5 w-5 flex rounded-full items-center border border-solid-100 justify-center",{" bg-primary-default":r," bg-surface-default":!r}),children:r&&e.jsx("div",{className:" w-2  h-2 rounded-full bg-accent-default"})})}function T({option:r,className:t}){return e.jsxs("div",{className:m("flex justify-center items-center flex-col pb-3  border-solid-100 ",t),children:[e.jsx("div",{className:"py-3 text-center px-20",children:e.jsx("span",{className:"  bg-light-default text-light-contrast rounded-xl py-1 px-3 text-base ",children:r.name})}),e.jsx("div",{className:"flex  flex-col items-start",children:r.data.map((l,d)=>e.jsxs("div",{className:"flex flex-row justify-center items-center gap-3 py-1",children:[e.jsx("div",{className:" bg-primary-default h-6 w-6   justify-center items-center flex rounded-full",children:"✔️"}),l]},d))})]})}function q({className:r,board:t,handleSelection:l,selectedOption:d}){return e.jsxs("div",{className:m("grid grid-cols-5  border-t border-solid-100 h-20",r),children:[e.jsxs("div",{className:"flex items-center justify-start gap-4 pr-2",children:[t.country&&e.jsx("img",{src:`/assets/${t.country.toLowerCase()}.png`,alt:"country",className:"h-12 w-12 rounded-full"}),L(t.country)]}),["standard","advanced","premium"].map(n=>{var o;const x=((o=t.license)==null?void 0:o.toLowerCase())===n;return t.status,e.jsx("div",{className:m("h-full flex items-center justify-center border-l border-solid-100"),children:x?e.jsx("div",{className:"flex items-center justify-center gap-3 border-x border-solid-100",children:e.jsx(C,{type:"primary",children:"Subscribed"})}):e.jsx("div",{className:"",onClick:()=>l(t.boardId,n),children:e.jsxs("div",{className:"flex cursor-pointer flex-row gap-1 rounded-md border border-solid-100 px-2 py-1.5 font-semibold text-[12]",children:[e.jsx(I,{isSelected:n===d}),"$ ",t[`${n}_rate`]]})})},n)}),e.jsx("div",{className:"border-l border-solid-100 flex flex-col items-center justify-center ",children:d?e.jsxs("div",{className:m("flex flex-col items-center justify-center"),children:[e.jsxs("span",{className:m({"opacity-30":!!t.license}),children:["$ ",d?t[`${d}_rate`]:""]}),e.jsx("span",{className:"text-content-tertiary",children:t.license?e.jsx("a",{href:"mailto:sales@afriqom.com",className:"text-blue-500",children:"Contact Sales"}):"Annual Cost"})]}):e.jsx("span",{className:""})})]})}const H=[{name:"Standard",data:["Add up to 5 users","Read only"]},{name:"Advanced",data:["Add up to 10 users","Read & Download"]},{name:"Premium",data:["Add up to 15 users","Read & Download"]}];function U({data:r,selectedSubscription:t,setSelectedSubscription:l}){return e.jsx("div",{className:"",children:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-6 gap-4  ",children:[e.jsx("div",{className:"col-start-1 col-end-7 -mt-4",children:e.jsxs("div",{className:"grid grid-cols-5 ",children:[e.jsx("div",{}),H.map((d,n)=>e.jsx(T,{className:m({" border-l":n!==2,"border-r":n==1,"border-r *:":n==2}),option:d},n)),e.jsx("div",{})]})}),e.jsx("div",{className:"col-start-1 col-end-7 -mt-4",children:e.jsx("div",{className:" flex flex-col",children:r&&r.map(d=>e.jsx(q,{className:"",board:d,selectedOption:t[d.boardId],handleSelection:(n,x)=>{const o={...t};o[n]&&o[n]===x?delete o[n]:o[n]=x,l(o)}},d.boardId))})})]})})})}function J(){return e.jsxs("div",{className:"my-8 mx-16 bg-surface-default p-5",children:[e.jsxs("p",{className:"text-xl font-semibold",children:["Ready to elevate your subscription experience?"," "]}),e.jsxs("p",{className:"text-base opacity-90",children:["Contact our dedicated team at"," ",e.jsx("span",{className:"text-primary-default font-bold",children:"sales@afriqom.com"})," ","to start your custom subscription journey today. Let us craft a bespoke experience tailored to your preferences, ensuring each delivery exceeds your expectations."]})]})}function K({organization:r,onCompleted:t}){const{organizationBoards:l,subscriptions:d,isLoading:n,databoards:x,refetchSubscription:o}=P(),{data:j}=E(),[i,N]=p.useState(void 0),[f,v]=p.useState(),[b,_]=p.useState();p.useEffect(()=>{if(b||!l||l.length==0||!j)return;const a=d==null?void 0:d.find(s=>s.package==="Full Access"),c=[{id:"1",name:"Individual Access",description:"Get access to all countries",data:l.map(s=>({...s,boardId:s.databoard_id,license:a?void 0:s.license}))},{id:"2",name:"Full Access",description:"Get access ao all countries",isRecommended:!0,discount:40,data:j.map(s=>({...s,boardId:s.id,...a}))},{id:"3",name:"Custom",description:"Tailored to your preferences"}];_(c),N("Individual Access"),v(c[0].data)},[l,b,j,d]);const[h,D]=p.useState({}),A=p.useMemo(()=>f?Object.entries(h).reduce((a,[c,s])=>{const u=f.find(y=>y.boardId===c);return u&&!u.license?a+Number(u[`${s}_rate`]??0):a},0):0,[f,h]),w=z(),M=()=>{if(!(!x||!j||!f)){if(i=="Individual Access"){const a={organisation_id:r.id,package:i,databoards:Object.entries(h).filter(([c])=>{const s=f.find(u=>u.boardId===c);return!(s!=null&&s.license)}).map(([c,s])=>{const u=x.find(S=>S.id===c);if(!u)throw new Error("No dashboard found");const y=new Date(new Date().setFullYear(new Date().getFullYear()+1));return{databoard_id:c,license:s,rate_paid:u[`${s}_rate`],start_date:g(new Date().toISOString()).format("YYYY-MM-DD"),expiry_date:g(y.toISOString()).format("YYYY-MM-DD")}})};w.actions.create({body:a},{onSuccess(){t(),o()}})}else if(i){const[a,c]=Object.entries(h)[0],s=j.find(S=>S.id===a);if(!s)throw new Error("No dashboard found");const u=new Date(new Date().setFullYear(new Date().getFullYear()+1)),y={region_id:s==null?void 0:s.id,organisation_id:r.id,license:"standard",rate_paid:s[`${c}_rate`],start_date:g(new Date().toISOString()).format("YYYY-MM-DD"),expiry_date:g(u.toISOString()).format("YYYY-MM-DD"),package:i};w.actions.create({body:y},{onSuccess(){t(),o()}})}}};return e.jsxs("div",{children:[n&&e.jsx(R,{}),b&&i&&e.jsxs(G,{spinning:w.state.isCreating,className:"py-5",children:[e.jsx("div",{className:" mb-16 grid grid-cols-3 gap-4",children:b.map((a,c)=>e.jsx("div",{onClick:()=>{N(a.name),v(a.data),D({})},className:m("py-3 px-3 cursor-pointer rounded-md border",{"border-5 border-primary-default bg-light-default ":i===a.name,"border-5 border-solid-100 bg-surface-secondary":i!==a.name}),children:e.jsxs("div",{className:"flex flex-row items-center gap-3",children:[e.jsx(I,{isSelected:i===a.name}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx("span",{className:" text-lg font-bold",children:a.name}),a.discount&&e.jsxs("div",{className:" rounded-2xl  bg-primary-secondary p-1 text-xs font-light text-primary-default",children:["save ",a==null?void 0:a.discount,"%"]})]}),e.jsx("span",{className:"text-xs",children:a.description}),a.isRecommended&&e.jsx("span",{className:m("text-sm font-bold text-primary-default"),children:"Recommended"})]})]})},c))}),e.jsx("div",{className:"mt-5 min-h-[50vh]",children:i=="Custom"?e.jsx(J,{}):e.jsx(U,{selectedSubscription:h,setSelectedSubscription:D,data:f??[]})}),e.jsxs("div",{className:m("flex mt-12",{"justify-between":i==="Individual Access","justify-end":i!=="Individual Access"}),children:[i==="Individual Access"&&e.jsx("div",{onClick:()=>{N("Full Access"),v(b[1].data)},className:"text-sm text-primary-default font-bold underline cursor-pointer",children:"Upgrade to full access and save 40%"}),i!=="Custom"&&e.jsxs("div",{className:"w-[250px]",children:[e.jsxs("div",{className:"text-lg mb-2 flex items-center justify-between w-full",children:[e.jsx("span",{className:"text-content-tertiary font-bold",children:"Total:"}),e.jsxs("div",{className:"font-bold text-primary-default",children:["$ ",A]})]}),e.jsx(C,{disabled:A==0,onClick:M,className:"w-full",type:"primary",children:"Subscribe"})]})]})]})]})}function ce(){const{currentOrganisation:r}=k().state,t=F();return e.jsx(O,{containerClassName:"max-w-7xl !mx-auto rounded-sm  !bg-surface-default shadow-md",children:e.jsxs("div",{className:"mx-auto -mt-2 w-full max-w-7xl text-content-default",children:[e.jsxs("div",{className:"flex items-center justify-between pt-5 mb-10",children:[e.jsx("h1",{children:"Buy Databoard"}),e.jsx($,{to:`${Y.dashboard}`,className:"text-content-default hover:text-primary-default",children:e.jsx(B,{className:"text-4xl"})})]}),r&&e.jsx(K,{onCompleted:()=>{t(Y.dashboard)},organization:r})]})})}export{ce as default};
